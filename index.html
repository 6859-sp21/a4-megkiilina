<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<style>
    @font-face{
        font-family: 'JetBrains Mono';
        src: url('https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/fonts/webfonts/JetBrainsMono-Regular.woff2') format('woff2'),
             url('https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/fonts/ttf/JetBrainsMono-Regular.ttf') format('truetype');
    }

    body {
        margin: 0px auto;
        font-family: "JetBrains Mono",monospace;
        font-size: 11pt;
        color: #e0e0e0;

        background-color: #1d1e38;
    }

    h1 {
        margin-top: 100px;
        margin-bottom:100px;
        font-size: 40pt;
        text-decoration: underline;
        text-decoration-style: dotted;
        text-decoration-color: #535359;
    }
    h2 {
        font-size: 70pt;
        opacity: 0.55;
    }
    h4 {
      display: inline;
      font-size: 7pt;
    }

    #authors {
        font-size: 16pt;
        text-align: left;
        margin-bottom: 100px;
        font-weight: bolder;
    }

    .body-copy {
        margin-bottom: 20px;
    }

    img {
        margin-top: 40px;
        margin-bottom: 10px;
    }

    .container-1 {
      width: 100%;
      display: flex;
      justify-content: space-between;
      background-color: #1d1e38;
    }

    .legend text.label  {
      fill: lightgrey;
      font-size: 8pt;
    }


    #map-container {
      position: fixed;
      font-size: 10pt;
      font-weight: bolder;
      text-align: center;
      right: 0px;
      width: 65%;
      height: 100%;
      margin-left: 20px;
    }

    .a {
      font-size: 5pt;
    }

    a {
        color:lightgrey;
    }

    #map-svg {
      display: inline-block;
    	position: absolute;
    	top: 0;
    	left: 0;
      width: 100%;
      height: 100%;
      float: right;
    }

    #map-footer{
        display: inline-block;
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        float: right;
        background-color: #1d1e38;
        height: 90px;
    }

    #map-toggle{
        float: left;
        margin-left: 20px;
        background-color: #2d2e98;
        color: lightgrey;
        border: solid 1px grey;
        font: inherit;
    }

    #year-label{
        float: left;
        padding-bottom: 15px;
    }

    #legend-svg{
        display: inline-block;
        width: 100%;
        float: right;
    }


    #citations {
        font-size: 11px;
        padding-top: 50px;
        width: 100%;
        overflow-wrap: anywhere;
    }

    #sections {
        width: 30%;
        left: 0px;
        padding-left: 2em;
        padding-right: 2em;
    }

    #sections > div {
        opacity: .2;
        margin-bottom: 200px;
    }

    #sections > div:last-child {
        margin-bottom: 90px;
    }

    #sections > div.graph-scroll-active {
        opacity: 1;
    }

    #graph {
        margin-top: 100px;
        width: 300px;
        position: -webkit-sticky;
        position: sticky;
        top: 0px;
    }

    .mono {
        font-family: monospace;
    }

</style>

<script src="lib/d3v4+jetpack.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>


<div id='container' class='container-1'>
    <div id='sections'>
      <div id='intro'>
        <h1>Atlas of<br> Telecomm- <br>unication<br> Technology<br> in the <br>20th Century</h1>
        <div id="authors">
            Kii Kang<br> Elina Oikonomaki<br> Megan Prakash <br>
        </div>
        <div class="body-copy">
            Humanity worldwide is continually developing new technology. Innovations such
            as the telephone, TV, and internet permanently change global communication, and
            adoption of novel technology is very disproportionate between countries.
            <p>
            Throughout the history of technology adoption documented in our dataset, a
            country's GDP is strongly correlated with how quickly it is able to adopt
            its use of a technology per capita. However, particular smaller countries like Japan and Germany
            often acquire technology disproportionately quickly.
            <p>
            Scroll on to see how these trends manifest throughout communications technology in the 20th century.
        </div><br>

        <div style="color: grey; font-size: 9pt; font-style: italic;">
            All y-axes are log scale and describe the total number of devices in a given country in a particular year.
            We chose not to do technology per capita, because the rate of technology acquisition is not related to
            a country’s population.
            <p>
            The issue with relating the two is particularly noticeable with the extremely
            populous China and India, where a large segment of the population is less privileged with access to new
            technology. Measuring technology per capita causes those countries to score very low compared to the rest
            of the world. On the other hand, technology acquisition showed a strong correlation with country GDP.
            <p>
            Dataset:
            <a href="https://github.com/datasets/historical-adoption-of-technology" target="_blank">
                Cross-country Historical Adoption of Technology (CHAT) dataset </a> with discussion
            <a href="https://www.nber.org/system/files/working_papers/w15319/w15319.pdf" target="_blank">here.</a>
        </div>
      </div>

      <div>
          <h2>TELE-<br>PHONE</h2>
          <h3>1876: Invention of the Telephone</h3>
          1876 saw the invention of the telephone by Alexander Graham Bell in Boston, USA, which other countries soon
          rushed to replicate [1]. The most successful countries of the century in telephone acquisition were the USA
          and Germany, who had rapidly set up commercial telephone manufacturing by 1877 [2].
          <p></p>
          By 1900, the USA led the world in adopting telephones with 1.3 million telephones by,
          while Germany came in second with 306,000.
          <p></p>
          <span style="background-color:#2d2e98">
          <i>Click on "Switch to GDP ratio view" to see which countries have a large number of telephones relative
          to their GDPs.</i>
          </span>
      </div>

      <div>
          <h2>RADIO</h2>
          <h3>1920: First commercial radio broadcast</h3>
          On November 2, 1920, the radio station KDKA in Pittsburgh, USA made the first ever commercial radio
          broadcast. [3] Decades prior, the Italian inventor Gugliermo Marconi had demonstrated radio communication
          in 1899. Though the USA was not considered to be the world leader in scientific and engineering innovation
          pre-1920, the American companies General Electric (GE), American Telephone and Telegraph (AT&T) and
          Westinghouse convened to form the Radio Company of America (RCA) and accelerate radio development in the
          USA. <p>

          The earliest data for the number of radios in the USA is from 1938; by that year, the USA led with
          40,800 radios, followed by Germany with 9,575, Russia with 5,624, and Japan with 4,166.
      </div>
      <div>
          <h2>CELL-<br>PHONE</h2>
          <h3>1983: First commercially available cellular phone</h3>
          Though the world’s first cellular network had already been launched in Japan by Nippon Telegraph and
          Telephone in 1979, it was not until 1983 when commercial cellular phone communication became available.
          The first 1G network was launched in the USA by Chicago-based Ameritech, shortly followed by the DynaTAC
          8000X, Motorola’s first commercial portable cellular phone. [5]

          From 1983-1985, the USA’s and Japan’s early access to cellular phone technology is clear,
          though Germany is quick to catch up by 1986.
      </div>
      <div>
          <h2>INTERNET</h2>
          <h3>1989: Invention of the World Wide Web</h3>
          The World Wide Web was invented in 1989 by Sir Tim Berners-Lee, an English contractor at CERN in
          Switzerland. Berners-Lee, in particular, was the first to use computer networking technologies and markup
          languages such as HTML to create an international, publicly-accessible network for sharing information. The
          early adopters of the Web were academic research institutions who were peers of Berners-Lee and CERN and
          quickly published research work as well as webcomics and animated images. [7]
          <p>
          The creation of the internet predates the World Wide Web by many decades, and internet innovation was
          primarily concentrated in the USA with collaborators in the UK and in France [6]. However, by 1995,
          it’s clear that Germany and Japan are once again disproportionately ahead of with Internet users
          relative to their GDP, while the USA is a full order of magnitude ahead with 25.2 million users
          compared to Japan and Germany’s 2 million.
      </div>

      <div>
          <h2>NOTE:</h2>
          <h3>1991: Fall of the Soviet Union</h3>
          A noticeable quirk in the dataset is related to the fall of the Soviet Union in 1991. On a
          significant number of technologies, Russia (considered to be the same bucket as the Soviet Union
          in this dataset) dipped significantly in technology usage starting 1990. While it is known that
          multitudes of Soviet  engineers and scientists left Russia following the dissolution of the USSR [8],
          a more likely explanation is that pre-1991, the “Russia” label of the dataset included the entire USSR.
          On the other hand, post-1991 it only includes the country of Russia and none of the sovereign states
          formed after the USSR’s collapse. The following graphs of population vs. GDP and population vs. year
          corroborate this guess, since it’s clear that the population of “Russia” dips after 1991.
          This dip is also apparent in the earlier graph about radio usage.

          <div id="citations">
              Citations:
              <p>
              [1] <a href="https://en.wikipedia.org/wiki/History_of_the_telephone" target = "_blank">
                History of the telephone</a>
              <p>
              [2] <a href="http://oldtelephones.com/blog/2012/09/04/bells-telephone-in-germany/" target="_blank">
                Bell's Telephone in Germany</a>
              <p>
              [3] <a href="http://www.pbs.org/wgbh/aso/databank/entries/dt20ra.html" target="_blank">
                A Science Odyssey: People and Discoveries: KDKA begins to broadcast.</a>
              <p>[4] <a href="https://www.sjsu.edu/faculty/watkins/radio.htm" target="_blank">
                The Economic History of the Radio Industry</a>
              <p>[5] <a href="https://en.wikipedia.org/wiki/History_of_mobile_phones" target="_blank">
                History of mobile phones</a>
              <p>[6] <a href="https://en.wikipedia.org/wiki/History_of_the_Internet" target="_blank">
                History of the Internet</a>
              <p>[7] <a href="https://en.wikipedia.org/wiki/History_of_the_World_Wide_Web" target="_blank">
                History of the World Wide Web</a>
              <p>[8] <a href="https://www.rbth.com/science_and_tech/2014/09/24/computers_in_the_ussr_a_story_of_missed_opportunities_40073.html" target="_blank">
                Computers in the USSR: A story of missed opportunities</a>
          </div>
      </div>

    </div>
    <div id='map-container'>
        <svg id="map-svg"></svg>
        <div id="map-footer">
            <div id="year-label"></div>
            <button id="map-toggle" onclick="toggleGDP()">Switch to GDP Ratio view</button><br>
            <svg id="legend-svg"></svg>
        </div>
    </div>
</div>



<div style="height:300px"></div>

<!-- Each 'container' div corresponds to one graph -->
<!-- See the js at the bottom of this file for where a d3 svg is assigned to .container-1 -->

<script src="lib/d3v4+jetpack.js"></script>
<script src="lib/graph-scroll.js"></script>
<script>

    var oldWidth = 0
    var gdpView = false
    var toggleEvent = new Event("toggle")
    var currentSection = 0

    function toggleGDP() {
        gdpView = !gdpView;
        document.getElementById("map-toggle").innerText = "Switch to " + (gdpView ? "Technology view" : "GDP Ratio view")
        d3.select("#map-svg").node().dispatchEvent(toggleEvent)
        console.log("toggled GDP view to " + gdpView)
    }

    function render() {
        if (oldWidth == innerWidth) return
        oldWidth = innerWidth

        let width = document.getElementById("map-container").offsetWidth,
            height = document.getElementById("map-container").offsetHeight;

        const countriesHighlighted = [[],
                           ["Germany"],
                           ["China", "Germany", "India", "Japan", "Russia", "United States"],
                           ["United States"],
                           ["China", "Germany", "India", "Japan", "Russia", "United States"]];
        const yearSeq = [1900, 1900, 1985, 1990, 1996, 1999];
        const techSeq = ["Telephone","Telephone","Radio","Cellphone","Internetuser","Xlpopulation"];
        const techSeqPlurals = ["Telephones","Telephones","Radios","Cellphones","Internet Users","Population"];

        // const countryColorCode = {"United States": "pink", "China": "green", "India": "red", "Russia": "purple", "Japan": "blue", "Germany": "brown"};

        //global vars
        let worldmap = d3.select("#map-svg");
        let legendSvg = d3.select("#legend-svg")
        let path = d3.geoPath();
        let techDisplayed;
        let yearDisplayed;
        let techDisplayedPlural;
        let max;


        let tooltip = d3.select("#map-container")
          .append("div")
          .style("position", "absolute")
          .style("visibility", "hidden")
          .style("width", "90px")
          .style("height", "70px")
          .style("padding-top", "20px")
          .style("border-style", "solid")
          .style("border-radius", "50%")
          .style("background", "white")
          .style("font-weight", "bold")
          .style("color", "black");



        let colorEncoding = d3.map();
        let colorScale = d3.scaleThreshold();
        // Load external data and boot.text(d.properties["name"])
        d3.queue()
            .defer(d3.json, "world.geojson")
            .await(ready);

        function ready(error, topo) {
            // D3 projections
            // https://sodocumentation.net/d3-js/topic/9001/d3-projections
            let projection = d3.geoMercator()
                .scale(width/7)
                .rotate([0, 0])
                .center([0, 65])

            let fillCountries = function (sectionIndex, gdpView){
                currentSection = sectionIndex
                console.log("currentSection = " + currentSection)
                techDisplayed = techSeq[sectionIndex].toString();
                techDisplayedPlural = techSeqPlurals[sectionIndex].toString()
                yearDisplayed = yearSeq[sectionIndex];
                let labelStr;
                if (gdpView) {
                    labelStr = "Ratio of " + techDisplayedPlural + " to GDP in " + yearDisplayed;
                } else {
                    labelStr = techDisplayedPlural + " in " + yearDisplayed;
                }
                console.log(labelStr);

                document.getElementById("year-label").innerHTML = labelStr

                d3.queue()
                  .defer(d3.csv, "aggregation/Historical_Agg_Cleaned.csv", function(d){
                      if (gdpView === false) {
                        // max = Math.max(d[techDisplayed]);
                        max = 1000000000;
                        if (techDisplayed === "Radio"){
                          max = 1000000;
                        }
                      } else if (gdpView === true) {
                        // max = Math.max(d[techDisplayed])/Math.max(d["Xlrealgdp"]);
                        max = 10;
                        if (techDisplayed === "Radio"){
                          max = 1;
                        }
                      }

                      return { year : +d.Year, country_name : d.Country, Cellphone : +d.Cellphone,
                          Internetuser: +d.Internetuser, Radio: +d.Radio, Telephone: +d.Telephone,
                          gdp: +d.Xlrealgdp, Xlpopulation: 1000 * +d.Xlpopulation }
                    },
                    function(data){
                      let dataFilteredByYear = data.filter(function(d) {
                        return d.year === yearDisplayed;
                      })
                      colorEncoding.clear();
                      if (gdpView === false){
                        dataFilteredByYear.forEach(function(d){
                          colorEncoding.set(d.country_name, d[techDisplayed]);
                      })} else if (gdpView === true){
                        dataFilteredByYear.forEach(function(d){
                          gdp = d.gdp || Infinity;
                          colorEncoding.set(d.country_name, d[techDisplayed]/gdp);
                        })
                      }
                      console.log(colorEncoding);
                      if (gdpView === false) {
                        colorScale = d3.scaleThreshold()
                            .domain([1, max/10000, max/1000, max/100, max/10, max])
                            .range(["#1d1e38", "#333345", "#535359", "#a3a087", "#c4c19f", "#dddbab", "#fffede"])
                      } else if (gdpView === true) {
                        colorScale = d3.scaleThreshold()
                            .domain([1, max/10000, max/1000, max/100, max/10, max])
                            .range(["#1d1e38", "#302e3b", "#4b443f", "#6e6044", "#b1964e", "#ecc757", "#ffd75a"])
                      }

                      d3.selectAll("path")
                        .transition()
                        .duration(1500)
                        .attr("fill", d => {
                          return colorScale(colorEncoding.get(d.properties["name"]) || 0) ;
                    })
                    })
                    .await(ready);

            }

            let createLegend = function(sectionIndex, gdpView) {
              // https://d3-legend.susielu.com/#color-examples
              let domainArray, legendScale;
              techDisplayed = techSeq[sectionIndex].toString();
              if (gdpView === false) {
                // max = Math.max(d[techDisplayed]);
                max = 1000000000;
                if (techDisplayed === "Radio"){
                  max = 1000000;
                }
                domainArray = [max/100000, max/10000, max/1000, max/100, max/10, max];
                legendScale = d3.scaleLog()
                  .domain(domainArray)
                  .range(["#333345", "#535359", "#a3a087", "#c4c19f", "#dddbab", "#fffede", "fff"]);
              } else if (gdpView === true) {
                // max = Math.max(d[techDisplayed])/Math.max(d["Xlrealgdp"]);
                max = 10;
                if (techDisplayed === "Radio"){
                  max = 1;
                }
                domainArray = [max/100000, max/10000, max/1000, max/100, max/10, max];
                legendScale = d3.scaleLog()
                  .domain(domainArray)
                  .range(["#302e3b", "#4b443f", "#6e6044", "#b1964e", "#ecc757", "#ffd75a", "fff"]);
              }

              legendSvg.append("g")
                .attr("class", "legend")
                .style("position", "fixed")
                .style("bottom", 0);

              var logLegend = d3.legendColor()
                  .cells(domainArray)
                  .shapePadding(0)
                  .shapeWidth(width/10)
                  .shapeHeight(5)
                  .orient("horizontal")
                  .scale(legendScale);
              if (gdpView === false) {
                logLegend.labels([ '10K', '100K', '1M', '10M', '100M', '1B']);
                if (techDisplayed === "Radio"){
                  logLegend.labels(['10', '100', '1K', '10K', '100K', '1M']);
                }
              } else if (gdpView === true) {
                logLegend.labels([ 'e-4', 'e-3', 'e-2', 'e-1', '1', '10']);
                if (techDisplayed === "Radio"){
                  logLegend.labels([ 'e-5', 'e-4', 'e-3', 'e-2', 'e-1', '1']);
                }
              }
              legendSvg.select(".legend")
                .call(logLegend);

            }

            let mouseOver = function (d) {
                d3.selectAll(".Country")
                    .style("opacity", .5)
                d3.select(this)
                    .transition()
                    .duration(200)
                    .attr('stroke-width', 2.5)
                    .style("opacity", 1)
                    return tooltip
                    .text(d.properties["name"])
                    .style("visibility", "visible");
            }

            let mouseLeave = function (d) {
                d3.selectAll(".Country")
                    .attr('stroke-width', .5)
                    .style("opacity", 1)
                d3.select(this)
                    .attr('stroke-width', .5)
                    .style("opacity", 1)
                    return tooltip
                    .style("visibility", "hidden");
            }

            var mapVis = worldmap.append("g")
                .selectAll("path")
                .data(topo.features)
                .enter()
                .append("path")
                .attr("stroke", "white")
                .attr('stroke-width', .5)
                .attr("class", d => { return "Country" } )
                .attr("d", d3.geoPath()
                    .projection(projection)
                )
                .on("mouseover", mouseOver )
                .on("mouseout", mouseLeave )
                .on("mousemove", function(d){
                  let tooltipNo = colorEncoding.get(d.properties["name"]) || 0;
                  let tooltipText = tooltipNo.toString();
                  if (gdpView === false){
                    if (tooltipNo > 1000000){
                      tooltipText = (Math.round(tooltipNo/100000)/10).toString() + "M";
                    } else if (tooltipNo > 1000){
                      tooltipText = (Math.round(tooltipNo/100)/10).toString() + "K";
                  }} else if (gdpView === true){
                    tooltipText = Math.round(tooltipNo*100)/ 100;
                  }
                  let mouseY = d3.mouse(this)[1]-110;
                  if (d3.mouse(this)[1] < 100){mouseY = d3.mouse(this)[1]+20};
                  if (gdpView === false) {
                    return tooltip
                      .style("top", mouseY + "px" )
                      .style("left",(d3.mouse(this)[0]-45)+"px")
                      .html(d.properties["name"] + "<br/>" + "<h4>" + tooltipText + '<br/>' + techDisplayedPlural + "</h4>")
                      .style("visibility", "visible");
                  } else if (gdpView === true) {
                    return tooltip
                      .style("top", mouseY + "px" )
                      .style("left",(d3.mouse(this)[0]-45)+"px")
                      .html(d.properties["name"] + "<br/>" + "<h4>" + tooltipText + '<br/>' + techDisplayedPlural + '/' + "GDP" + "</h4>")
                      .style("visibility", "visible");
                  }})



            var mapHandler = d3.graphScroll()
            .container(d3.select(".container-1"))
            .graph(d3.selectAll('#map-container'))
            .eventId('mapId') // namespace for events
            .sections(d3.selectAll('.container-1 #sections > div'))
            .on("active", function(i) { fillCountries(i, gdpView), createLegend(i, gdpView) })

            var toggleHandler = d3.select("#map-svg").on("toggle", function(i) {
                fillCountries(currentSection, gdpView)
                createLegend(currentSection, gdpView)
            })

        }


        // d3.select('#source')
        //     .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
    }

    render()
    d3.select(window).on('resize', render)


</script>
