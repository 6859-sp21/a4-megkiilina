<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<style>
    @font-face{
        font-family: 'JetBrains Mono';
        src: url('https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/fonts/webfonts/JetBrainsMono-Regular.woff2') format('woff2'),
             url('https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/fonts/ttf/JetBrainsMono-Regular.ttf') format('truetype');
    }

    body {
        margin: 0px auto;
        font-family: "JetBrains Mono",monospace;
        font-size: 11pt;
        color: #e0e0e0;

        background-color: #1d1e38;
    }

    h1 {
        margin-top: 100px;
        margin-bottom:100px;
        font-size: 36pt;
        text-decoration: underline;
        text-decoration-style: dotted;
        text-decoration-color: #535359;
    }
    h2 {
        font-size: 70pt;
        opacity: 0.55;
    }
    h4 {
      display: inline;
      font-size: 7pt;
    }

    #authors {
        font-size: 16pt;
        text-align: left;
        margin-bottom: 100px;
        font-weight: bolder;
    }

    .body-copy {
        margin-bottom: 20px;
    }

    img {
        margin-top: 40px;
        margin-bottom: 10px;
    }

    .container-1 {
      width: 100%;
      display: flex;
      justify-content: space-between;
      background-color: #1d1e38;
    }

    .legend text.label  {
      fill: lightgrey;
      font-size: 8pt;
    }


    #map-container {
      position: fixed;
      font-size: 10pt;
      font-weight: bolder;
      text-align: center;
      right: 30px;
      width: 58%;
        top: 30px;
      height: 100%;
      margin-left: 20px;
    }

    .a {
      font-size: 5pt;
    }

    a {
        color:lightgrey;
    }

    #map-svg {
      display: inline-block;
    	position: absolute;
    	top: 0;
    	left: 0;
      width: 100%;
      height: 100%;
      float: right;
    }

    #map-footer{
        display: inline-block;
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        float: right;
        background-color: #1d1e38;
        height: 90px;
    }

    #year-label{
        float: left;
        padding-bottom: 15px;
    }

    #legend-svg{
        display: inline-block;
        width: 100%;
        float: right;
    }


    #citations {
        font-size: 10px;
        padding-top: 50px;
        width: 100%;
        overflow-wrap: anywhere;
    }

    #sections {
        width: 35%;
        left: 0px;
        padding-left: 2em;
        padding-right: 2em;
    }

    #sections > div {
        opacity: .2;
        margin-bottom: 200px;
    }

    #sections > div:last-child {
        margin-bottom: 90px;
    }

    #sections > div.graph-scroll-active {
        opacity: 1;
    }

    #graph {
        margin-top: 100px;
        width: 300px;
        position: -webkit-sticky;
        position: sticky;
        top: 0px;
    }

    .mono {
        font-family: monospace;
    }

</style>

<script src="lib/d3v4+jetpack.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>


<div id='container' class='container-1'>
    <div id='sections'>
      <div id='intro'>
        <h1>Atlas of<br> Telecomm- unication Technology<br> in the 20th Century</h1>
        <div id="authors">
            Kii Kang<br> Elina Oikonomaki<br> Megan Prakash <br>
        </div>
        <div class="body-copy">
            Humanity worldwide is continually developing new technology. Innovations such
            as the telephone, TV, and internet permanently change global communication, and
            adoption of novel technology is very disproportionate between countries.
            <p>
            Throughout the history of technology adoption documented in our dataset, a
            country's GDP is strongly correlated with how quickly it is able to adopt
            its use of a technology per capita. However, particular smaller countries like Japan and Germany
            often acquire technology disproportionately quickly.
            <p>
            Scroll on to see how these trends manifest throughout communications technology in the 20th century.
        </div><br>

        <div style="font-size: 9pt; font-style: italic;">
            All y-axes are log scale and describe the total number of devices in a given country in a particular year.
            We chose not to do technology per capita, because the rate of technology acquisition is not related to
            a country’s population.
            <p>
            The issue with relating the two is particularly noticeable with the extremely
            populous China and India, where a large segment of the population is less privileged with access to new
            technology. Measuring technology per capita causes those countries to score very low compared to the rest
            of the world. On the other hand, technology acquisition showed a strong correlation with country GDP.
            <p>
            Dataset:
            <a href="https://github.com/datasets/historical-adoption-of-technology" target="_blank">
                Cross-country Historical Adoption of Technology (CHAT) dataset </a> with discussion
            <a href="https://www.nber.org/system/files/working_papers/w15319/w15319.pdf" target="_blank">here.</a>
        </div>
      </div>

        <div>
            <h2>Tele-<br>phone</h2>
            <h3>1876: Invention of the Telephone</h3>
            1876 saw the invention of the telephone by Alexander Graham Bell in Boston, USA, which other countries soon
            rushed to replicate [1]. The most successful countries of the century in telephone acquisition were the USA
            and Germany, who had rapidly set up commercial telephone manufacturing by 1877 [2].
            <p></p>
            By 1900, the USA led the world in adopting telephones with 1.3 million telephones by,
            while Germany came in second with 306,000.
        </div>

        <div>
            <h2>Radio</h2>
            <h3>1920: First commercial radio broadcast</h3>
            On November 2, 1920, the radio station KDKA in Pittsburgh, USA made the first ever commercial radio
            broadcast. [3] Decades prior, the Italian inventor Gugliermo Marconi had demonstrated radio communication
            in 1899. Though the USA was not considered to be the world leader in scientific and engineering innovation
            pre-1920, the American companies General Electric (GE), American Telephone and Telegraph (AT&T) and
            Westinghouse convened to form the Radio Company of America (RCA) and accelerate radio development in the
            USA. <p>

            The earliest data for the number of radios in the USA is from 1938; by that year, the USA led with
            40,800 radios, followed by Germany with 9,575, Russia with 5,624, and Japan with 4,166.
        </div>
        <div>
            <h2>Cell-<br>phone</h2>
            <h3>1983: First commercially available cellular phone</h3>
            Though the world’s first cellular network had already been launched in Japan by Nippon Telegraph and
            Telephone in 1979, it was not until 1983 when commercial cellular phone communication became available.
            The first 1G network was launched in the USA by Chicago-based Ameritech, shortly followed by the DynaTAC
            8000X, Motorola’s first commercial portable cellular phone. [5]

            From 1983-1985, the USA’s and Japan’s early access to cellular phone technology is clear,
            though Germany is quick to catch up by 1986.
        </div>
        <div>
            <h2>Internet</h2>
            <h3>1989: Invention of the World Wide Web</h3>
            The World Wide Web was invented in 1989 by Sir Tim Berners-Lee, an English contractor at CERN in
            Switzerland. Berners-Lee, in particular, was the first to use computer networking technologies and markup
            languages such as HTML to create an international, publicly-accessible network for sharing information. The
            early adopters of the Web were academic research institutions who were peers of Berners-Lee and CERN and
            quickly published research work as well as webcomics and animated images. [7]
            <p>
            The creation of the internet predates the World Wide Web by many decades, and internet innovation was
            primarily concentrated in the USA with collaborators in the UK and in France [6]. However, by 1995,
            it’s clear that Germany and Japan are once again disproportionately ahead of with Internet users
            relative to their GDP, while the USA is a full order of magnitude ahead with 25.2 million users
            compared to Japan and Germany’s 2 million.
        </div>

        <div>
            <h2>Note:</h2>
            <h3>1991: Fall of the Soviet Union</h3>
            A noticeable quirk in the dataset is related to the fall of the Soviet Union in 1991. On a
            significant number of technologies, Russia (considered to be the same bucket as the Soviet Union
            in this dataset) dipped significantly in technology usage starting 1990. While it is known that
            multitudes of Soviet  engineers and scientists left Russia following the dissolution of the USSR [8],
            a more likely explanation is that pre-1991, the “Russia” label of the dataset included the entire USSR.
            On the other hand, post-1991 it only includes the country of Russia and none of the sovereign states
            formed after the USSR’s collapse. The following graphs of population vs. GDP and population vs. year
            corroborate this guess, since it’s clear that the population of “Russia” dips after 1991.
            This dip is also apparent in the earlier graph about radio usage.

            <div id="citations">
                Citations:
                [1] https://en.wikipedia.org/wiki/History_of_the_telephone
                <p>
                [2] http://oldtelephones.com/blog/2012/09/04/bells-telephone-in-germany/
                <p>
                [3] http://www.pbs.org/wgbh/aso/databank/entries/dt20ra.html
                <p>[4] https://www.sjsu.edu/faculty/watkins/radio.htm
                <p>[5] https://en.wikipedia.org/wiki/History_of_mobile_phones
                <p>[6] https://en.wikipedia.org/wiki/History_of_the_Internet
                <p>[7] https://en.wikipedia.org/wiki/History_of_the_World_Wide_Web
                <p>[8] https://www.rbth.com/science_and_tech/2014/09/24/computers_in_the_ussr_a_story_of_missed_opportunities_40073.html
            </div>
        </div>

    </div>
    <div id='map-container'>
        <svg id="map-svg"></svg>
        <div id="map-footer">
            <button id="map-toggle" onclick="toggleGDP()">switch to tech:GDP view</button>
            <div id="year-label"></div> <br>
            <svg id="legend-svg"></svg>
        </div>
    </div>
</div>



<div style="height:300px"></div>

<!-- Each 'container' div corresponds to one graph -->
<!-- See the js at the bottom of this file for where a d3 svg is assigned to .container-1 -->

<script src="lib/d3v4+jetpack.js"></script>
<script src="lib/graph-scroll.js"></script>
<script>

    var oldWidth = 0
    var gdpView = false

    function toggleGDP() {
        gdpView = !gdpView;
        document.getElementById("map-toggle").innerText = "switch to " + (gdpView ? "tech view" : "tech:GDP view")
        console.log("toggled GDP view to " + gdpView)
    }

    function render() {
        if (oldWidth == innerWidth) return
        oldWidth = innerWidth

        let width = document.getElementById("map-container").offsetWidth,
            height = document.getElementById("map-container").offsetHeight;

        // const coord = {"center": [[0, 60], [-6, 40], [-6, 40], [18, 36], [21, 60], [-6, 37], [150, 90]],
        //     "scale": [width/4, 500, 500, 600, 600, 500, 400],
        //     "rotate": [[-20, 0], [90, 0], [90, 0], [-120, 0], [0, 0], [-110, 0], [20, 0]]};

        const coord = {"center": [[0, 60], [0, 60], [0, 60], [0, 60], [0, 60], [0, 60], [-10, 50], [0, 60], [-6, 40], [18, 36], [21, 60], [-6, 37], [150, 90]],
            "scale": [width/4, width/4, width/4, width/4, width/4, width/4, width/4, width/2, 1000, 1200, 1200, 1000, 400],
            "rotate": [[-20, 0],[-20, 0],[-20, 0], [-20, 0], [-20, 0], [-20, 0], [-20, 0], [-20, 0], [90, 0], [90, 0], [-120, 0], [0, 0], [-110, 0], [20, 0]]};

        const countriesHighlighted = [[],
                           ["Germany"],
                           ["China", "Germany", "India", "Japan", "Russia", "United States"],
                           ["United States"],
                           ["China", "Germany", "India", "Japan", "Russia", "United States"]];
        const yearSeq = [1900, 1900, 1985, 1990, 1996, 1999];
        const techSeq = ["Telephone","Telephone","Radio","Cellphone","Internetuser","Xlpopulation"];
        const techSeqPlurals = ["Telephones","Telephones","Radios","Cellphones","Internet Users","People"];

        // const countryColorCode = {"United States": "pink", "China": "green", "India": "red", "Russia": "purple", "Japan": "blue", "Germany": "brown"};

        //global vars
        let worldmap = d3.select("#map-svg");
        let legendSvg = d3.select("#legend-svg")
        let path = d3.geoPath();
        let techDisplayed;
        let yearDisplayed;
        let techDisplayedPlural;
        let max;
        // tooltip interaction
        let tooltip = d3.select("#map-container")
          .append("div")
          .style("position", "absolute")
          .style("visibility", "hidden")
          .style("width", "90px")
          .style("height", "70px")
          .style("padding-top", "20px")
          .style("border-style", "solid")
          .style("border-radius", "50%")
          .style("background", "white")
          .style("font-weight", "bold")
          .style("color", "black");



        let colorEncoding = d3.map();
        let colorScale = d3.scaleThreshold();
        // Load external data and boot.text(d.properties["name"])
        d3.queue()
            .defer(d3.json, "world.geojson")
            .await(ready);

        function ready(error, topo) {
            // D3 projections
            // https://sodocumentation.net/d3-js/topic/9001/d3-projections
            let projection = d3.geoMercator()
                .scale(width)
                .rotate([0, 0])
                .center([0, 0])
                // .scale(width/8)
                // .center(coord["center"][0])
                // .rotate(coord["rotate"][0])
                // // .parallels([65, 65])
                // .translate([0, width/4]);

            let zoomExtent = function (sectionIndex) {
                console.log(sectionIndex + 'th section active');
                // if (sectionIndex === 0) return;
                // if (sectionIndex >= countries.length) return;
                //
                // projection.center(coord["center"][sectionIndex]);
                projection.scale(width/8);
                projection.translate([width/2, height/2])
                // projection.rotate(coord["rotate"][sectionIndex]);
                //
                d3.selectAll("path")
                    .transition("zoom")
                    .duration(2000)
                    .attr("d", d3.geoPath()
                        .projection(projection)
                    )
                    //highlight countries where event has taken place(optional?)
                    // .filter(d => countriesHighlighted[sectionIndex].includes(d.properties["name"]))
                    // .transition()
                    // .duration(1500)
                    // .attr("fill", (d, i) => {return countryColorCode[d.properties["name"]] || "red";})
                    // .transition()
                    // .duration(1500)
                    // .attr("fill", d => {
                    //   return colorScale(colorEncoding.get(d.properties["name"]) || 0);
                    // })
            }

            let fillCountries = function (sectionIndex){
                techDisplayed = techSeq[sectionIndex].toString();
                techDisplayedPlural = techSeqPlurals[sectionIndex].toString()
                yearDisplayed = yearSeq[sectionIndex];
                var labelStr = techDisplayedPlural + " in " + yearDisplayed
                console.log(labelStr);

                document.getElementById("year-label").innerHTML = labelStr

                d3.queue()
                  .defer(d3.csv, "aggregation/Historical_Agg_Cleaned.csv", function(d){
                      max = Math.max(d[techDisplayed]);
                      return { year : +d.Year, country_name : d.Country, Cellphone : +d.Cellphone,
                          Internetuser: +d.Internetuser, Radio: +d.Radio, Telephone: +d.Telephone,
                          Xlpopulation: +d.Xlpopulation  }
                    },
                    function(data){
                      let dataFilteredByYear = data.filter(function(d) {
                        return d.year === yearDisplayed;
                      })
                      colorEncoding.clear();
                      dataFilteredByYear.forEach(function(d){
                        colorEncoding.set(d.country_name, d[techDisplayed]);
                      })
                      console.log(colorEncoding);
                      colorScale = d3.scaleThreshold()
                          .domain([1, max/5000, max/500, max/50, max/5, max])
                          .range(["#1d1e38", "#333345", "#535359", "#a3a087", "#c4c19f", "#dddbab", "#fffede"])
                      d3.selectAll("path")
                        .transition()
                        .duration(1500)
                        .attr("fill", d => {
                          return colorScale(colorEncoding.get(d.properties["name"]) || 0) ;
                    })
                    })
                    .await(ready);

            }

            let createLegend = function() {
              // https://d3-legend.susielu.com/#color-examples
              max = 1000000000;
              console.log(max);
              var legendScale = d3.scaleLog()
                  .domain([1,max/100000, max/10000, max/1000, max/100, max/10, max])
                  .range(["#1d1e38", "#333345", "#535359", "#a3a087", "#c4c19f", "#dddbab", "#fffede", "fff"]);

              legendSvg.append("g")
                .attr("class", "legend")
                .style("position", "fixed")
                .style("bottom", 0);

              var logLegend = d3.legendColor()
                  .cells([10, 100, 1000, 10000, 100000, 1000000, 10000000, 100000000, 1000000000])
                  .shapePadding(0)
                  .shapeWidth(width/10)
                  .shapeHeight(5)
                  .orient("horizontal")
                  .labels(['10', '100', '1K', '10K', '100K', '1M', '10M', '100M', '1B'])
                  .scale(legendScale);

              legendSvg.select(".legend")
                .call(logLegend);

            }

            let mouseOver = function (d) {
                if(d3.active("zoom")) return;
                d3.selectAll(".Country")
                    .style("opacity", .5)
                d3.select(this)
                    .transition()
                    .duration(200)
                    .attr('stroke-width', 2.5)
                    .style("opacity", 1)
                    return tooltip
                    .text(d.properties["name"])
                    .style("visibility", "visible");
            }

            let mouseLeave = function (d) {
                if(d3.active("zoom")) return;
                d3.selectAll(".Country")
                    .attr('stroke-width', .5)
                    .style("opacity", 1)
                d3.select(this)
                    .attr('stroke-width', .5)
                    .style("opacity", 1)
                    return tooltip
                    .style("visibility", "hidden");
            }

            var mapVis = worldmap.append("g")
                .selectAll("path")
                .data(topo.features)
                .enter()
                .append("path")
                .attr("stroke", "white")
                .attr('stroke-width', .5)
                .attr("class", d => { return "Country" } )
                .attr("d", d3.geoPath()
                    .projection(projection)
                )
                .on("mouseover", mouseOver )
                .on("mouseout", mouseLeave )
                .on("mousemove", function(d){
                  let tooltipNo = colorEncoding.get(d.properties["name"]) || 0;
                  let tooltipText = tooltipNo.toString();
                  if (tooltipNo > 1000000){
                    tooltipText = (Math.round(tooltipNo/100000)/10).toString() + "M"
                  } else if (tooltipNo > 1000){
                    tooltipText = (Math.round(tooltipNo/100)/10).toString() + "K"
                  }
                  let mouseY = d3.mouse(this)[1]-110;
                  if(d3.mouse(this)[1] <100){mouseY = d3.mouse(this)[1]+20}
                  return tooltip
                    .style("top", mouseY + "px" )
                    .style("left",(d3.mouse(this)[0]-45)+"px")
                    .html(d.properties["name"] + "<br/>" + "<h4>" + tooltipText + '<br/>' + techDisplayedPlural + "</h4>")
                    .style("visibility", "visible");})


            var mapHandler = d3.graphScroll()
            .container(d3.select(".container-1"))
            .graph(d3.selectAll('#map-container'))
            .eventId('mapId') // namespace for events
            .sections(d3.selectAll('.container-1 #sections > div'))
            .on("active", function(i) { zoomExtent(i), fillCountries(i), createLegend() })

        }

        // I'm Graph #1
        // var gs = d3.graphScroll()
        //     .container(d3.select('.container-1'))
        //     .graph(d3.selectAll('container-1 #graph'))
        //     .eventId('mapID')  // namespace for scroll and resize events
        //     .sections(d3.selectAll('.container-1 #sections > div'))
        //     .on('active', function (i) {
        //         var pos = [{cx: width - r, cy: r},
        //             {cx: r, cy: r},
        //             {cx: width - r, cy: height - r},
        //             {cx: width / 2, cy: height / 2}][i]
        //
        //         circle.transition().duration(1000)
        //             .attrs(pos)
        //             .transition()
        //             .style('fill', colors[i])
        //     })



        // d3.select('#source')
        //     .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
    }

    render()
    d3.select(window).on('resize', render)


</script>
